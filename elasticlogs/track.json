{
  "meta": {
    "short-description": "Data generator for long running bulk indexing benchmarks",
    "description": "This track generates data based on a selected subset of traffic to the elastic.co website, which has been anonymized and post-processed."
  },
  "indices": [
    {
      "name": "elasticlogs",
      "types": [
        {
          "name": "logs",
          "mapping": "mappings.json"
        }
      ]
    }
  ],
  "#COMMENT": "'operations' just define all possible operations but this is not the actual execution schedule. The execution is defined in the 'challenges' block and it just refers to the defined operations. The intention between this separation is to allow reuse of operations",
  "operations": [
    {
      "name": "index-append-1000",
      "operation-type": "index",
      "param-source": "elasticlogs",
      "bulk-size": 1000
    },
    {
      "name": "index-append-500",
      "operation-type": "index",
      "param-source": "elasticlogs",
      "bulk-size": 500
    },
    {
      "name": "index-append-250",
      "operation-type": "index",
      "param-source": "elasticlogs",
      "bulk-size": 250
    },
    {
      "name": "index-append-125",
      "operation-type": "index",
      "param-source": "elasticlogs",
      "bulk-size": 125
    },
    {
      "name": "index-append-1000-elasticlogs_write",
      "operation-type": "index",
      "param-source": "elasticlogs",
      "index": "elasticlogs_write",
      "bulk-size": 1000
    },
    {
      "name": "create_elasticlogs_write",
      "operation-type": "createindex",
      "index_name": "elasticlogs-000001",
      "alias": "elasticlogs_write",
      "index_template_body": {
        "template": "elasticlogs*",
        "settings": {
          "index.refresh_interval": "5s",
          "index.codec": "best_compression"
        },
        "mappings": {
          "logs": {
            "properties": {
              "@timestamp": { "type": "date" },
              "@message": { "type": "text", "index": false },
              "agent": { "type": "keyword", "ignore_above": 256 },
              "bytes": { "type": "integer" },
              "clientip": { "type": "ip" },
              "httpversion": { "type": "keyword", "ignore_above": 256 },
              "response": { "type": "short" },
              "verb": { "type": "keyword", "ignore_above": 256 },
              "geoip" : {
                "properties" : {
                  "country_name" : { "type": "keyword" },
                  "location" : { "type": "geo_point" }
                }
              },
              "useragent": {
                "properties": {
                  "name": { "type": "keyword", "ignore_above": 256 },
                  "os": { "type": "keyword", "ignore_above": 256 },
                  "os_name": { "type": "keyword", "ignore_above": 256 }
                }
              },
              "request": {
                "norms": false,
                "type": "text",
                "fields": {
                  "keyword": { "ignore_above": 256, "type": "keyword" }
                }
              },
              "referrer": {
                "norms": false,
                "type": "text",
                "fields": {
                  "keyword": { "ignore_above": 256, "type": "keyword" }
                }
              }
            },
            "_all": { "enabled": false }
          }
        },
        "aliases": {}
      },
      "index_template_name": "elasticlogs"
    },
    {
      "name": "rollover_elasticlogs_write",
      "operation-type": "rollover",
      "alias": "elasticlogs_write",
      "body": {
        "conditions": {
          "max_age":   "1d",
          "max_docs":  1000000
        }
      }
    },
    {
      "name": "scanscroll_new_elasticlogs_1m",
      "operation-type": "scanscroll",
      "index": "elasticlogs-*",
      "query": {
        "query": {
          "range" : {
            "@timestamp" : {
              "gte" : "now-1m",
              "lt" :  "now"
            }
          }
        }
      }
    },
    {
      "name": "scanscroll_new_elasticlogs_5m",
      "operation-type": "scanscroll",
      "index": "elasticlogs-*",
      "query": {
        "query": {
          "range" : {
            "@timestamp" : {
              "gte" : "now-5m",
              "lt" :  "now"
            }
          }
        }
      }
    }
  ],
  "challenges": [
    {
      "name": "append-no-conflicts",
      "description": "Indexes using 8 clients and runs indexing with a batch size of 1000 for 10 minutes. IDs are autogenerated by Elasticsearcg, meaning there are no conflicts.",
      "index-settings": {
        "index.number_of_replicas": 0
      },
      "schedule": [
        {
          "operation": "index-append-1000",
          "warmup-time-period": 0,
          "time-period": 600,
          "clients": 8
        }
      ]
    },
    {
      "name": "append-no-conflicts-varying-bulk-size",
      "description": "Indexes using 8 clients and runs 4 different batchsizes for 5 minutes each. IDs are autogenerated by Elasticsearcg, meaning there are no conflicts.",
      "index-settings": {
        "index.number_of_replicas": 0
      },
      "schedule": [
        {
          "operation": "index-append-125",
          "warmup-time-period": 0,
          "time-period": 300,
          "clients": 8
        },
        {
          "operation": "index-append-250",
          "warmup-time-period": 0,
          "time-period": 300,
          "clients": 8
        },
        {
          "operation": "index-append-500",
          "warmup-time-period": 0,
          "time-period": 300,
          "clients": 8
        },
        {
          "operation": "index-append-1000",
          "warmup-time-period": 0,
          "time-period": 300,
          "clients": 8
        }
      ]
    },
    {
      "name": "append-no-conflicts-index-only",
      "description": "Indexes using 8 threads during 30 minutes. IDs are autogenerated by Elasticsearcg, meaning there are no conflicts.",
      "index-settings": {
        "index.number_of_replicas": 0
      },
      "schedule": [
        {
          "operation": "index-append-1000",
          "warmup-time-period": 0,
          "time-period": 1800,
          "clients": 8
        }
      ]
    },
    {
      "name": "test",
      "description": "Runs through and tests all parameter sources and runners.",
      "index-settings": {
        "index.number_of_replicas": 0
      },
      "schedule": [
        {
          "operation": "create_elasticlogs_write",
          "clients": 1,
          "warmup-iterations": 0,
          "iterations": 1,
        },
        {
          "parallel": {
            "warmup-time-period": 0,
            "time-period": 600,
            "tasks": [
              {
                "operation": "index-append-1000-elasticlogs_write",
                "target-throughput": 10,
                "clients": 8
              },
              {
                "operation": "rollover_elasticlogs_write",
                "target-throughput": 0.01666667
              },
              {
                "operation": "scanscroll_new_elasticlogs_1m",
                "target-throughput": 0.01666667
              }
            ]
          }
        }
      ]
    }
  ]
}

